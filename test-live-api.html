<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Live AI Upashthiti API</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .success { background: #4caf50; color: white; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        .error { background: #f44336; color: white; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        .example { background: #f5f5f5; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        .button:hover { background: #45a049; }
        .results { background: #e7f3ff; padding: 10px; margin: 10px 0; border-radius: 4px; }
        input[type="file"], input[type="text"] { margin: 5px; padding: 8px; }
        .api-url { background: #333; color: #0f0; padding: 10px; border-radius: 4px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="success">
        <h3>‚úÖ Testing Live Railway API</h3>
        <p>API URL: <code>https://web-production-13b09.up.railway.app</code></p>
        <p><a href="https://web-production-13b09.up.railway.app/docs" target="_blank" style="color: white;">üìñ View API Documentation</a></p>
    </div>

    <h1>ü§ñ Test AI Upashthiti Live API</h1>
    
    <div class="example">
        <h2>üîç Test Face Recognition</h2>
        <p>Upload an image to test face recognition with your live API:</p>
        <input type="file" id="recognizePhoto" accept="image/*" />
        <button class="button" onclick="testRecognition()">üîç Recognize Faces</button>
        <div id="recognizeResult" class="results" style="display:none;"></div>
    </div>

    <div class="example">
        <h2>üë• Get Registered Students</h2>
        <button class="button" onclick="getStudents()">üìã Load Students</button>
        <div id="studentsResult" class="results" style="display:none;"></div>
    </div>

    <div class="example">
        <h2>üìä API Health Check</h2>
        <button class="button" onclick="checkHealth()">üè• Check API Health</button>
        <div id="healthResult" class="results" style="display:none;"></div>
    </div>

    <div class="example">
        <h2>üìù Correct API URLs</h2>
        <div class="api-url">
            <strong>‚úÖ CORRECT (Live Railway API):</strong><br>
            POST https://web-production-13b09.up.railway.app/api/analyze<br><br>
            
            <strong>‚ùå INCORRECT (Local - Not Running):</strong><br>
            POST http://localhost:8000/api/analyze
        </div>
    </div>

    <script>
        // ‚úÖ Your LIVE Railway API URL
        const API_URL = 'https://web-production-13b09.up.railway.app';
        
        // üîç Test Face Recognition
        async function testRecognition() {
            const file = document.getElementById('recognizePhoto').files[0];
            
            if (!file) {
                alert('Please select a photo to test');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                showLoading('recognizeResult');
                console.log('üîÑ Testing API:', `${API_URL}/api/analyze`);
                
                const response = await fetch(`${API_URL}/api/analyze`, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('‚úÖ API Response:', result);
                
                let html = `
                    <h3>üéâ Recognition Successful!</h3>
                    <p><strong>Message:</strong> ${result.message}</p>
                    <p><strong>Total Faces Detected:</strong> ${result.total_faces_detected}</p>
                    <p><strong>Recognized Students:</strong> ${result.recognized_faces.length}</p>
                    <p><strong>Model Used:</strong> ${result.model_used}</p>
                `;
                
                if (result.recognized_faces.length > 0) {
                    html += '<h4>üë• Recognized Students:</h4><ul>';
                    result.recognized_faces.forEach(face => {
                        html += `
                            <li>
                                <strong>${face.name}</strong> 
                                (Confidence: ${(face.confidence * 100).toFixed(1)}%)
                                ${face.student_id ? ` - ID: ${face.student_id}` : ''}
                            </li>
                        `;
                    });
                    html += '</ul>';
                } else {
                    html += '<p>‚ùå No registered students found in this image</p>';
                }
                
                document.getElementById('recognizeResult').innerHTML = html;
                
            } catch (error) {
                console.error('‚ùå API Error:', error);
                showError('recognizeResult', error.message);
            }
        }
        
        // üë• Get Students Function
        async function getStudents() {
            try {
                showLoading('studentsResult');
                console.log('üîÑ Getting students from:', `${API_URL}/api/students`);
                
                const response = await fetch(`${API_URL}/api/students`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('‚úÖ Students Response:', result);
                
                let html = `
                    <h3>üë• Registered Students (${result.total})</h3>
                `;
                
                if (result.students.length > 0) {
                    html += '<ul>';
                    result.students.forEach(student => {
                        html += `
                            <li>
                                <strong>${student.name}</strong>
                                ${student.student_id ? ` (ID: ${student.student_id})` : ''}
                                ${student.registered_at ? ` - Registered: ${new Date(student.registered_at).toLocaleDateString()}` : ''}
                            </li>
                        `;
                    });
                    html += '</ul>';
                } else {
                    html += '<p>No students registered yet</p>';
                }
                
                document.getElementById('studentsResult').innerHTML = html;
                
            } catch (error) {
                console.error('‚ùå Students API Error:', error);
                showError('studentsResult', error.message);
            }
        }
        
        // üè• Health Check Function
        async function checkHealth() {
            try {
                showLoading('healthResult');
                console.log('üîÑ Checking health:', `${API_URL}/api/health`);
                
                const response = await fetch(`${API_URL}/api/health`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('‚úÖ Health Response:', result);
                
                let html = `
                    <h3>üè• API Health Status</h3>
                    <p><strong>Status:</strong> ${result.status}</p>
                    <p><strong>Buffalo Model:</strong> ${result.buffalo_model_loaded ? '‚úÖ Loaded' : '‚ùå Not Available'}</p>
                    <p><strong>InsightFace:</strong> ${result.insightface_available ? '‚úÖ Available' : '‚ùå Not Available'}</p>
                    <p><strong>Timestamp:</strong> ${new Date(result.timestamp).toLocaleString()}</p>
                `;
                
                document.getElementById('healthResult').innerHTML = html;
                
            } catch (error) {
                console.error('‚ùå Health API Error:', error);
                showError('healthResult', error.message);
            }
        }
        
        // Helper Functions
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = '<p>‚è≥ Testing API...</p>';
        }
        
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = `<p style="color: red;">‚ùå Error: ${message}</p>`;
        }
        
        // Test API connection on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Testing API connection...');
            checkHealth();
        });
    </script>
</body>
</html>