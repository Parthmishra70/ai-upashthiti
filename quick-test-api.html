<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick API Test - AI Upashthiti</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .success { background: #4caf50; color: white; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        .error { background: #f44336; color: white; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        .test-section { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .button { background: #2196F3; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; margin: 5px; }
        .button:hover { background: #1976D2; }
        .results { background: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 6px; border-left: 4px solid #2196F3; }
        .api-info { background: #333; color: #0f0; padding: 15px; border-radius: 6px; font-family: monospace; margin: 20px 0; }
        input[type="file"] { margin: 10px 0; padding: 8px; }
    </style>
</head>
<body>
    <div class="success">
        <h2>üöÄ AI Upashthiti API - Quick Test</h2>
        <p><strong>Live API:</strong> https://web-production-13b09.up.railway.app</p>
        <p><strong>Status:</strong> ‚úÖ Online and Ready</p>
    </div>

    <div class="api-info">
        <strong>‚úÖ CORRECT API ENDPOINTS:</strong><br>
        POST https://web-production-13b09.up.railway.app/api/analyze<br>
        GET  https://web-production-13b09.up.railway.app/api/students<br>
        GET  https://web-production-13b09.up.railway.app/api/health<br><br>
        
        <strong>‚ùå WRONG (Local - Not Running):</strong><br>
        POST http://localhost:8000/api/recognize
    </div>

    <div class="test-section">
        <h3>üîç Test Face Recognition</h3>
        <input type="file" id="testImage" accept="image/*">
        <button class="button" onclick="testRecognition()">üîç Test Recognition</button>
        <div id="recognitionResult"></div>
    </div>

    <div class="test-section">
        <h3>üë• Get Students</h3>
        <button class="button" onclick="getStudents()">üìã Get Students</button>
        <div id="studentsResult"></div>
    </div>

    <div class="test-section">
        <h3>üè• API Health</h3>
        <button class="button" onclick="checkHealth()">üè• Check Health</button>
        <div id="healthResult"></div>
    </div>

    <script>
        const API_URL = 'https://web-production-13b09.up.railway.app';

        async function testRecognition() {
            const file = document.getElementById('testImage').files[0];
            if (!file) {
                alert('Please select an image first');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            try {
                document.getElementById('recognitionResult').innerHTML = '<p>‚è≥ Testing recognition...</p>';
                
                const response = await fetch(`${API_URL}/api/recognize`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                
                document.getElementById('recognitionResult').innerHTML = `
                    <div class="results">
                        <h4>üéâ Recognition Success!</h4>
                        <p><strong>Message:</strong> ${result.message}</p>
                        <p><strong>Faces Detected:</strong> ${result.total_faces_detected}</p>
                        <p><strong>Recognized:</strong> ${result.recognized_faces.length}</p>
                        <p><strong>Model:</strong> ${result.model_used}</p>
                        ${result.recognized_faces.length > 0 ? 
                            '<p><strong>Students:</strong> ' + result.recognized_faces.map(f => `${f.name} (${(f.confidence*100).toFixed(1)}%)`).join(', ') + '</p>'
                            : '<p>No registered students found</p>'
                        }
                    </div>
                `;
            } catch (error) {
                document.getElementById('recognitionResult').innerHTML = `
                    <div class="error">‚ùå Error: ${error.message}</div>
                `;
            }
        }

        async function getStudents() {
            try {
                document.getElementById('studentsResult').innerHTML = '<p>‚è≥ Loading students...</p>';
                
                const response = await fetch(`${API_URL}/api/students`);
                const result = await response.json();
                
                document.getElementById('studentsResult').innerHTML = `
                    <div class="results">
                        <h4>üë• Registered Students (${result.total})</h4>
                        ${result.students.length > 0 ? 
                            '<ul>' + result.students.map(s => `<li><strong>${s.name}</strong>${s.student_id ? ` (ID: ${s.student_id})` : ''}</li>`).join('') + '</ul>'
                            : '<p>No students registered</p>'
                        }
                    </div>
                `;
            } catch (error) {
                document.getElementById('studentsResult').innerHTML = `
                    <div class="error">‚ùå Error: ${error.message}</div>
                `;
            }
        }

        async function checkHealth() {
            try {
                document.getElementById('healthResult').innerHTML = '<p>‚è≥ Checking health...</p>';
                
                const response = await fetch(`${API_URL}/api/health`);
                const result = await response.json();
                
                document.getElementById('healthResult').innerHTML = `
                    <div class="results">
                        <h4>üè• API Health Status</h4>
                        <p><strong>Status:</strong> ${result.status}</p>
                        <p><strong>Buffalo Model:</strong> ${result.buffalo_model_loaded ? '‚úÖ Loaded' : '‚ùå Not Available'}</p>
                        <p><strong>InsightFace:</strong> ${result.insightface_available ? '‚úÖ Available' : '‚ùå Not Available'}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('healthResult').innerHTML = `
                    <div class="error">‚ùå Error: ${error.message}</div>
                `;
            }
        }

        // Auto-test health on page load
        window.onload = () => checkHealth();
    </script>
</body>
</html>